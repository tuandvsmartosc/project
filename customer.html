<script>
    function getCustomer() {
        customertable.clear();
        jQuery.ajax({
            type: "GET",
            dataType: "html",
            url: "http://mage1.dev/index.php/helloworld/index/customer",
            data: {}
        }).done(function (html) {
            var returnMsg = jQuery.parseJSON(html);
            customerData = prepareDataForCustomerTable(returnMsg);
            customertable.rows.add(customerData); // Add new data
            customertable.columns.adjust().draw(); // Redraw the DataTable
        });
    }

    function toObject(arr) {
        var rv = {};
        for (var i = 0; i < arr.length; ++i)
            rv[i] = arr[i];
        return rv;
    }
    function prepareDataForCustomerTable(customers) {
//        console.log(customers);
        var data = [];
        if (customers == null) {
            return []
        };


        customers = toObject(customers);
//        console.log(customers);
        jQuery.each(customers, function (kos, customer) {
            data.push([
                customer.entity_id,
                customer.firstname,
                customer.lastname,
                customer.email,
                customer.group_id
            ]);
        });
        customerData = data;
        return data;
    }

    function format ( d ) {
        // `d` is the original data object for the row
        return '<table cellpadding="5" cellspacing="0" border="0" style="padding-left:50px; background: tomato">'+
            '<tr>'+
            '<td>Entity_id:</td>'+
            '<td>'+d[0]+'</td>'+
            '</tr>'+
            '<tr>'+
            '<td>First Name:</td>'+
            '<td>'+d[1]+'</td>'+
            '</tr>'+
            '<tr>'+
            '<td>Last Name:</td>'+
            '<td>'+d[2]+'</td>'+
            '</tr>'+
            '<tr>'+
            '<td>Email:</td>'+
            '<td>'+d[3]+'</td>'+
            '</tr>'+
            '<tr>'+
            '<td>Group_ID:</td>'+
            '<td>'+d[4]+'</td>'+
            '</tr>'+
            '</table>';
    }


    $(document).ready(function () {
        customertable = $('#customer').DataTable({
            "searching": true,
            'bSort': false,
            'aoColumns': [
                {sWidth: "45%", bSearchable: true, bSortable: false},
                {sWidth: "45%", bSearchable: true, bSortable: false},
                {sWidth: "10%", bSearchable: true, bSortable: false},

                {
                    "className":      'details-control',
                    "orderable":      false,
                    "data":           null,
                    "defaultContent": ''
                }
            ],
            "scrollCollapse": true,
            "info": true,
            "paging": true

        });
    });



    // Add event listener for opening and closing details
    $('#customer').on('click', '.details-control', function () {
        var tr = $(this).closest('tr');
        var row = customertable.row( tr );
        console.log(row.data());

        if ( row.child.isShown() ) {
            // This row is already open - close it
            row.child.hide();
            tr.removeClass('shown');
        }
        else {
            // Open this row
            row.child( format(row.data()) ).show();
            tr.addClass('shown');
        }
    } );



    $(window).load(function(){
        // do something
        customertable.clear();
        getCustomer();
    });



</script>